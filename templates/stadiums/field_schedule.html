{% extends "base.html" %}
{% block title %}Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ - {{ field.name }}{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 1400px;">
    
    <h2 class="schedule-title">ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù„Ù„Ù…Ù„Ø¹Ø¨: {{ field.name }}</h2>
    <p class="lead" style="color: var(--dark-blue-stadium);">
        <span class="fw-bold">Ø§Ù„Ø§Ø³ØªØ§Ø¯:</span> {{ field.stadium.name }} | 
        <span class="ms-3">ğŸ“</span> {{ field.stadium.location }}
    </p>

    {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="table-schedule-container">
        <div class="table-responsive">
            <table class="table table-schedule">
                <thead>
                    <tr>
                        <th width="12%">Ø§Ù„ÙŠÙˆÙ…</th>
                        <th width="10%">Ù…Ù†</th>
                        <th width="10%">Ø¥Ù„Ù‰</th>
                        <th width="12%">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th width="30%">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</th>
                        <th width="26%">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody>
                    {% for day_data in week_slots %}
                        {% for slot in day_data.slots %}
                            <tr>
                                <td>
                                    <span class="day-highlight">{{ day_data.day|date:"Y-m-d" }}</span>
                                </td>
                                <td class="fw-bold">{{ slot.start|time:"H:i" }}</td>
                                <td class="fw-bold">{{ slot.end|time:"H:i" }}</td>
                                <td>
                                    {% if slot.status == "available" %}
                                        <span class="badge-soft-success">âœ… Ù…ØªØ§Ø­</span>
                                    {% elif slot.status == "pending" %}
                                        <span class="badge-soft-warning">â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯</span>
                                    {% elif slot.status == "confirmed" %}
                                        <span class="badge-soft-success">âœ”ï¸ Ù…Ø¤ÙƒØ¯</span>
                                    {% elif slot.status == "canceled" %}
                                        <span class="badge-soft-danger">ğŸš« Ù…Ù„ØºÙŠ</span>
                                    {% else %}
                                        <span class="badge bg-secondary text-white">ØºÙŠØ± Ù…ØªØ§Ø­</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if slot.booking %}
                                        <div class="booking-info-box">
                                            <b>ğŸ‘¤ {{ slot.booking.full_name }}</b>
                                            <div class="small">
                                                <span>ğŸ“ {{ slot.booking.phone }}</span> |
                                                <span>ğŸ“ {{ slot.booking.address }}</span>
                                            </div>
                                        </div>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if slot.status == "available" %}
                                        <form method="post" action="{% url 'create_booking' field.id %}" class="bg-light p-2 rounded text-start">
                                            {% csrf_token %}
                                            <input type="hidden" name="start" value="{{ slot.start|date:'Y-m-d H:i' }}">
                                            <div class="row g-2">
                                                <div class="col-12"><input type="text" name="full_name" class="form-control form-control-sm" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required></div>
                                                <div class="col-6"><input type="number" name="age" class="form-control form-control-sm" placeholder="Ø§Ù„Ø¹Ù…Ø±" required></div>
                                                <div class="col-6"><input type="tel" name="phone" class="form-control form-control-sm" placeholder="Ø§Ù„Ù‡Ø§ØªÙ" required></div>
                                                <div class="col-12"><input type="text" name="address" class="form-control form-control-sm" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹" required></div>
                                                <div class="col-12"><button type="submit" class="btn btn-success btn-sm w-100">ğŸ“‹ Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</button></div>
                                            </div>
                                        </form>
                                    {% elif slot.status == "pending" and user == field.stadium.owner %}
                                        <div class="d-flex gap-2 justify-content-center">
                                            <form method="post" action="{% url 'booking_action' slot.booking_id %}">
                                                {% csrf_token %}
                                                <button type="submit" name="action" value="approve" class="btn btn-primary btn-sm">âœ… ØªØ£ÙƒÙŠØ¯</button>
                                            </form>
                                            <form method="post" action="{% url 'booking_action' slot.booking_id %}">
                                                {% csrf_token %}
                                                <button type="submit" name="action" value="reject" class="btn btn-danger btn-sm">âŒ Ø±ÙØ¶</button>
                                            </form>
                                        </div>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}